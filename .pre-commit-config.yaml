# This is the configuration file for the pre-commit framework, a simple way
# to manage, install and run git hooks to catch common problems early on.
# See https://pre-commit.com/ for details.
#
# If you have Python >= 3.7 and python-pip installed, just run:
#
#     $ pip install --user pre-commit
#     $ git clone https://github.com/your-fork-of/mixxx.git
#     $ cd mixxx
#     $ pre-commit install
#     $ pre-commit install -t pre-push
#
# It will now run relevant hooks automatically on every `git commit` or
# `git push` in the mixxx git repository.
#
# If you have a problems with a particular hook, you can use the `$SKIP`
# environment variable to disable hooks:
#
#     $ SKIP=clang-format,end-of-file-fixer git commit
#
# This can also be used to separate logic changes and autoformatting into
# two subsequent commits.
#
# Using the `$SKIP` var is preferable to using `git commit --no-verify`
# because it won't prevent catching other, unrelated issues.

# _anlz.h/_pdb.h: Header files generated by Kaitai Struct
exclude: ^(lib/|src/test/.*data/).*|res/controllers/lodash\.mixxx\.js|src/.*_(anlz|pdb)\.h$
minimum_pre_commit_version: 2.21.0
default_language_version:
  python: python3
  rust: 1.64.0
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: cef0300fd0fc4d2a87a85fa2093c6b283ea36f4b # frozen: v5.0.0
    hooks:
      - id: fix-byte-order-marker
        exclude: ^.*(\.cbproj|\.groupproj|\.props|\.sln|\.vcxproj|\.vcxproj.filters|UTF-8-BOM.txt)$
      - id: check-case-conflict
      - id: check-json
      - id: check-merge-conflict
      - id: check-xml
      - id: check-yaml
        exclude: ^\.clang-format$
      - id: end-of-file-fixer
        exclude: ^(res/translations/.*\.ts|.*UTF-8-BOM\.txt)$
      - id: mixed-line-ending
      - id: trailing-whitespace
        exclude: \.(c|cc|cxx|cpp|ts|frag|glsl|h|hpp|hxx|ih|ispc|ipp|java|js|m|mm|proto|tsv|vert)$
      - id: no-commit-to-branch
        # protect main and any branch that has a semver-like name
        args: [-b, main, -p, '^\d+\.\d+(?:\.\d+)?$']
  - repo: https://github.com/codespell-project/codespell
    rev: 63c8f8312b7559622c0d82815639671ae42132ac # frozen: v2.4.1
    hooks:
      - id: codespell
        args:
          [
            --exclude-file,
            .codespellignorelines,
            --ignore-words,
            .codespellignore,
            --ignore-regex,
            "\\W(?:m_p*(?=[A-Z])|m_(?=\\w)|pp*(?=[A-Z])|k(?=[A-Z])|s_(?=\\w))",
            --write-changes,
          ]
        exclude: ^(packaging/wix/LICENSE.rtf.in|src/dialog/dlgabout\.cpp|res/linux/org\.mixxx\.Mixxx\.desktop|.*\.(?:pot?|(?<!\.d\.)ts|wxl|svg))$
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: 98fae3b56bd052fa68b76f5f753111f3aab35758 # frozen: v9.21.0
    hooks:
      - id: eslint
        args:
          [
            --fix,
            --report-unused-disable-directives,
            --max-warnings,
            "0",
            --no-warn-ignored,
          ]
        files: \.m?[jt]s$
        types: [file]
        additional_dependencies:
          - eslint@^9.21.0
          - "@eslint/js"
          - typescript-eslint
          - eslint-plugin-jsdoc@^v50.6.3
          - eslint-plugin-diff@^2.0.3
        exclude: ^res/translations/.*\.ts$
  - repo: local
    hooks:
      - id: clang-format
        name: clang-format
        description: "Run clang-format in two passes (reformat, then break long lines)"
        entry: python tools/clang_format.py
        require_serial: true
        language: python
        additional_dependencies:
          - clang-format==19.1.3
        files: \.(c|cc|cxx|cpp|frag|glsl|h|hpp|hxx|ih|ispc|ipp|java|m|mm|proto|vert)$
  - repo: https://github.com/psf/black
    rev: 8a737e727ac5ab2f1d4cf5876720ed276dc8dc4b # frozen: 25.1.0
    hooks:
      - id: black
        files: ^tools/.*$
  - repo: https://github.com/pycqa/flake8
    rev: "bddd87797f8dfc07d2a10c894776018d9bec590b" # frozen: 7.1.2
    hooks:
      - id: flake8
        files: ^tools/.*$
        types: [text, python]
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: a23f6b85d0fdd5bb9d564e2579e678033debbdff # frozen: v0.10.0.1
    hooks:
      - id: shellcheck
  - repo: https://github.com/DavidAnson/markdownlint-cli2
    rev: d174eb7a8f35e05d4065c82d375ad84aa0b32352 # frozen: v0.17.2
    hooks:
      - id: markdownlint-cli2
  - repo: https://github.com/python-jsonschema/check-jsonschema
    rev: 828a213a1dd17aa9862aab706e3162c13281ff93 # frozen: 0.31.2
    hooks:
      - id: check-github-workflows
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: f12edd9c7be1c20cfa42420fd0e6df71e42b51ea # frozen: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types: [yaml]
  - repo: https://github.com/qarmin/qml_formatter.git
    rev: 37c2513b1b8275a475a160ed2f5b044910335d5f # No release tag yet including #6 fix
    hooks:
      - id: qml_formatter
  - repo: https://github.com/gitleaks/gitleaks
    rev: f565e4e10c6c8081e374235bb4e4bcb8c0c2fa63 # frozen: v8.24.0
    hooks:
      - id: gitleaks
  - repo: https://github.com/woodruffw/zizmor-pre-commit
    rev: 842b1ccf60ff913680eb3de66a4f8c4ce1297661 # frozen: v1.4.1
    hooks:
      - id: zizmor
        args: [--pedantic]
  - repo: local
    hooks:
      - id: qsscheck
        name: qsscheck
        description: Run qsscheck to detect broken QSS.
        entry: python tools/qsscheck.py
        args: [.]
        pass_filenames: false
        language: python
        additional_dependencies:
          - tinycss==0.4
        types: [text]
        files: ^.*\.qss$
      - id: changelog
        name: changelog
        description: Add missing links to changelog.
        entry: python tools/changelog.py
        language: python
        types: [text]
        files: ^CHANGELOG.md$
      - id: qmllint
        name: qmllint
        entry: qmllint
        pass_filenames: true
        require_serial: true
        language: system
        types: [text]
        files: ^.*\.qml$
      - id: metainfo
        name: metainfo
        description: Update AppStream metainfo releases from CHANGELOG.md.
        entry: python tools/update_metainfo.py
        pass_filenames: false
        language: python
        additional_dependencies:
          - beautifulsoup4==4.12.3
          - lxml==5.3.0
          - Markdown==3.7
        types: [text]
        files: ^(CHANGELOG\.md|res/linux/org\.mixxx\.Mixxx\.metainfo.xml)$
      - id: ts-source-copy
        name: ts-source-copy
        description: "Find translations literally copied from the source language"
        entry: python tools/ts_source_copy_check.py
        require_serial: true
        language: python
        additional_dependencies:
          - lxml==5.3.0
        files: ^(res/translations/.*\.ts)$
